/* Ferropoly-Game V2.3.2, 25-07-2019, (c) Christian Kuster, CH-8342 Wernetshausen, christian@kusti.ch */

"use strict";moment.locale("de");var indexControl=angular.module("indexApp",[]);indexControl.controller("indexCtrl",["$scope","$http",function($scope,$http){$scope.user=user,$scope.gameplays=[],$scope.games=[],$scope.gameplayToDelete=void 0,moment().hour()<4?$scope.intro="Hallo":moment().hour()<10?$scope.intro="Guten Morgen":moment().hour()<17?$scope.intro="Hallo":$scope.intro="Guten Abend";$scope.isGameRunning=function(gp){return moment(gp.scheduling.gameEndTs).isBefore(moment())?-1:moment(gp.scheduling.gameDate).isAfter(moment())?1:0},$scope.isGameOver=function(gp){return moment(gp.scheduling.gameEndTs).isBefore(moment())},$scope.getGpInfo=function(gp){return moment(gp.scheduling.gameEndTs).isBefore(moment())?"Spiel ist "+moment(gp.scheduling.gameEndTs).fromNow(!1)+" zu Ende gegangen.":moment(gp.scheduling.gameStartTs).isAfter(moment())?"Spiel startet "+moment(gp.scheduling.gameStartTs).fromNow(!1)+".":moment().isBetween(moment(gp.scheduling.gameStartTs),moment(gp.scheduling.gameEndTs))?"Spiel startete "+moment(gp.scheduling.gameStartTs).fromNow(!1)+".":""},$scope.userIsAdmin=function(gp){return gp.internal.owner===$scope.user.personalData.email},$scope.createOrganisatorInfo=function(gp){var retVal="";return gp.owner&&gp.owner.organisatorName&&(retVal+=gp.owner.organisatorName+" "),retVal+=gp.internal.owner},$scope.hasNoGamesAtAll=function(){return 0===$scope.games.length&&0===$scope.gameplays.length},$scope.hasOnlyGameplays=function(){return 0===$scope.games.length&&0<$scope.gameplays.length},$scope.hasOnlyGames=function(){return 0<$scope.games.length&&0===$scope.gameplays.length},$scope.hasGamesAndGameplays=function(){return 0<$scope.games.length&&0<$scope.gameplays.length},$scope.hasGameplays=function(){return 0<$scope.gameplays.length},$scope.hasGames=function(){return 0<$scope.games.length},$scope.isTeamleader=function(game){return _.get(game,"team.data.teamLeader.email","x")===_.get(user,"personalData.email")},$scope.acceptAgb=function(){$http({method:"POST",url:"/agb/accept"}).then(function(){$scope.agb.accepted=!0},function(resp){console.error(resp)})},$scope.declineAgb=function(){$http({method:"POST",url:"/logout"}).then(function(){console.log("logged out"),window.location.replace("/")},function(resp){console.error(resp)})},$(document).ready(function(){var index=moment().hours()%6;$("#info-header").css("background-image",'url("/images/ferropoly_header_0'+index+'.jpg")'),$http({method:"GET",url:"/agb"}).then(function(resp){console.log(resp),$scope.agb=resp.data.info,$scope.agb.actionRequired&&$("#agb-trigger").click()},function(resp){console.error(resp)}),$http({method:"GET",url:"/gameplays"}).then(function(resp){$scope.gameplays=resp.data.gameplays||[],$scope.games=resp.data.games||[],console.log("Gameplays loaded, nb:"+$scope.gameplays.length),console.log("Games loaded, nb:"+$scope.games.length),$http({method:"GET",url:"/authtoken"}).then(function(resp){resp.data.authToken,console.log("Auth ok")},function(resp){console.error(resp),$scope.panel="error",$scope.errorMessage="Authentisierungsfehler. Status: "+resp.status})},function(resp){console.error(resp),$scope.gameplays=[],$scope.panel="error",$scope.errorMessage="Spiele konnten nicht geladen werden. Status: "+resp.status})})}]);