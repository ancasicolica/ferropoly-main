/* Ferropoly-Game V2.0.8, 05-06-2017, (c) Christian Kuster, CH-8342 Wernetshausen, christian@kusti.ch */

"use strict";var teamCtrl=angular.module("teamApp",[]);teamCtrl.controller("teamCtrl",["$scope","$http",function($scope,$http){function showSuccessInfo(message){var lastMessage=message;!function(msg){$scope.successMessage=msg,_.delay(function(){$scope.successMessage===lastMessage&&($scope.successMessage="",$scope.$apply())},5e3)}(message)}function showError(message){var lastMessage=message;!function(msg){$scope.errorMessage=msg,_.delay(function(){$scope.errorMessage===lastMessage&&($scope.errorMessage="",$scope.$apply())},1e4)}(message)}function getTeams(){$http({method:"GET",url:"/team/members/"+gameId+"/"+teamId}).then(function(resp){$scope.members=resp.data.members,console.log(resp)},function(resp){showError("Fehler beim Laden der Teammitglieder"),console.error(resp)})}$scope.members=[],$scope.newMember="",$scope.addMember=function(){var newMember=$scope.newMember;$scope.newMember="",!newMember||newMember.length<4?console.warn("No new member found"):$http({method:"POST",url:"/team/members/"+gameId+"/"+teamId,data:{newMemberLogin:newMember,authToken:$scope.authToken}}).then(function(resp){$scope.members=resp.data.members,showSuccessInfo(newMember+" hinzugefügt"),console.log(resp)},function(resp){showError("Das Teammitglied konnte nicht gespeichert werden"),console.error(resp)})},$scope.deleteMember=function(memberToDelete){$scope.memberToDelete=memberToDelete},$scope.finallyDelete=function(){$scope.memberToDelete&&$http({method:"DELETE",url:"/team/members/"+gameId+"/"+teamId,headers:{"Content-Type":"application/json;charset=utf-8"},data:{memberToDelete:$scope.memberToDelete.login,authToken:$scope.authToken}}).then(function(resp){$scope.members=resp.data.members,console.log(resp)},function(resp){showError("Das Teammitglied konnte nicht gelöscht werden"),console.error(resp)})},$(document).ready(function(){$http({method:"GET",url:"/authtoken"}).then(function(resp){$scope.authToken=resp.data.authToken,console.log("Auth ok")},function(resp){showError("Wir haben ein Authentisierungsproblem"),console.error(resp)}),getTeams()})}]);